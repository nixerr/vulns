#!/bin/sh


export CC="clang"
export CXX="clang++"
export CXXFLAGS="-stdlib=libc++ -O0 -ggdb"
export CFLAGS="-O0 -ggdb"
export PATH="/tools/cmake-3.26.1-linux-x86_64/bin:$PATH"
export PATH="/tools/clang+llvm-8.0.0-x86_64-linux-gnu-ubuntu-16.04/bin:$PATH"

cd JavaScriptCore && rm -rf WebKitBuild 
git reset --hard && git checkout master
sed -i -e "s|apt-get install|apt-get -y install|g" /tools/JavaScriptCore/Tools/gtk/install-dependencies
/tools/JavaScriptCore/Tools/gtk/install-dependencies

git reset --hard
git checkout aa4c06d30b67a396f62c4888e9d80442e65dd656
sed -i -e 's|set(ENABLE_WEBCORE ON)|set(ENABLE_WEBCORE ON)\nset(CMAKE_EXPORT_COMPILE_COMMANDS 1)|' CMakeLists.txt
./Tools/Scripts/set-webkit-configuration --debug
./Tools/Scripts/build-jsc --jsc-only

rm -rf compile_commands.json
ln -s WebKitBuild/Debug/compile_commands.json compile_commands.json
printf '%%compile_commands.json\n%%h -x\n%%h c++-header\n%%h --include=config.h\n%%cpp --include=config.h' > .ccls